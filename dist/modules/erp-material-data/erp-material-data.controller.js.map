{"version":3,"sources":["../../../src/modules/erp-material-data/erp-material-data.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Param,\r\n  ParseIntPipe,\r\n  Post,\r\n  Body,\r\n  Patch,\r\n  UseGuards,\r\n  Req,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiParam,\r\n  ApiBody,\r\n  ApiBearerAuth,\r\n} from '@nestjs/swagger';\r\nimport { ErpMaterialDataService } from './erp-material-data.service';\r\nimport { UpdateIssueStageDto } from './dto/update-issue-stage.dto';\r\nimport { IncrementIssueStageDto } from './dto/increment-issue-stage.dto';\r\nimport { UpdatePackingStageDto } from './dto/update-packing-stage.dto';\r\nimport { IncrementPackingStageDto } from './dto/increment-packing-stage.dto';\r\nimport { JwtAuthGuard } from '../auth/jwt-auth.guard';\r\nimport { Roles } from '../auth/roles.decorator';\r\nimport { AuthRequest } from '../auth/types/auth-request.type';\r\n\r\n@ApiTags('ERP Material Data')\r\n@ApiBearerAuth()\r\n@UseGuards(JwtAuthGuard)\r\n@Controller('admin/orders/:orderId/erp-materials')\r\nexport class ErpMaterialDataController {\r\n  constructor(\r\n    private readonly erpMaterialDataService: ErpMaterialDataService,\r\n  ) {}\r\n\r\n  @ApiOperation({ summary: 'Get ERP materials for a sales order' })\r\n  @ApiParam({ name: 'orderId', type: Number, description: 'Sales Order ID' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'List of ERP materials for the order.',\r\n  })\r\n  @Get()\r\n  @Roles('ADMIN', 'USER')\r\n  getMaterialsByOrderId(\r\n    @Param('orderId', ParseIntPipe) orderId: number,\r\n    @Req() req: AuthRequest,\r\n  ) {\r\n    const { userId, role } = req.user;\r\n    return this.erpMaterialDataService.getMaterialsByOrderId(orderId, userId, role);\r\n  }\r\n\r\n  @ApiOperation({ summary: 'Increment issue stage for a material code' })\r\n  @ApiParam({ name: 'orderId', type: Number, description: 'Sales Order ID' })\r\n  @ApiBody({ type: IncrementIssueStageDto })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Issue stage incremented successfully.',\r\n  })\r\n  @Post('increment-issue-stage')\r\n  @Roles('ADMIN', 'USER')\r\n  incrementIssueStage(\r\n    @Param('orderId', ParseIntPipe) orderId: number,\r\n    @Body() body: IncrementIssueStageDto,\r\n    @Req() req: AuthRequest,\r\n  ) {\r\n    const { userId, role } = req.user;\r\n    return this.erpMaterialDataService.incrementIssueStage(\r\n      orderId,\r\n      body.materialCode,\r\n      userId,\r\n      role\r\n    );\r\n  }\r\n\r\n  @ApiOperation({ summary: 'Update issue stage for a material code (inline edit)' })\r\n  @ApiParam({ name: 'orderId', type: Number, description: 'Sales Order ID' })\r\n  @ApiBody({ type: UpdateIssueStageDto })\r\n  @Patch('update-issue-stage')\r\n  @Roles('ADMIN', 'USER')\r\n  updateIssueStage(\r\n    @Param('orderId', ParseIntPipe) orderId: number,\r\n    @Body() body: UpdateIssueStageDto,\r\n    @Req() req: AuthRequest,\r\n  ) {\r\n    const { userId, role } = req.user;\r\n    return this.erpMaterialDataService.updateIssueStage(\r\n      orderId,\r\n      body.materialCode,\r\n      body.issueStage,\r\n      userId,\r\n      role\r\n    );\r\n  }\r\n\r\n  @ApiOperation({ summary: 'Increment packing stage for a material code' })\r\n  @ApiParam({ name: 'orderId', type: Number, description: 'Sales Order ID' })\r\n  @ApiBody({ type: IncrementPackingStageDto })\r\n  @Post('increment-packing-stage')\r\n  @Roles('ADMIN', 'USER')\r\n  incrementPackingStage(\r\n    @Param('orderId', ParseIntPipe) orderId: number,\r\n    @Body() body: IncrementPackingStageDto,\r\n    @Req() req: AuthRequest,\r\n  ) {\r\n    const { userId, role } = req.user;\r\n    return this.erpMaterialDataService.incrementPackingStage(\r\n      orderId,\r\n      body.materialCode,\r\n      userId,\r\n      role\r\n    );\r\n  }\r\n\r\n  @ApiOperation({ summary: 'Update packing stage for a material code (inline edit)' })\r\n  @ApiParam({ name: 'orderId', type: Number, description: 'Sales Order ID' })\r\n  @ApiBody({ type: UpdatePackingStageDto })\r\n  @Patch('update-packing-stage')\r\n  @Roles('ADMIN', 'USER')\r\n  updatePackingStage(\r\n    @Param('orderId', ParseIntPipe) orderId: number,\r\n    @Body() body: UpdatePackingStageDto,\r\n    @Req() req: AuthRequest,\r\n  ) {\r\n    const { userId, role } = req.user;\r\n    return this.erpMaterialDataService.updatePackingStage(\r\n      orderId,\r\n      body.materialCode,\r\n      body.packingStage,\r\n      userId,\r\n      role\r\n    );\r\n  }\r\n}\r\n"],"names":["ErpMaterialDataController","getMaterialsByOrderId","orderId","req","userId","role","user","erpMaterialDataService","incrementIssueStage","body","materialCode","updateIssueStage","issueStage","incrementPackingStage","updatePackingStage","packingStage","summary","name","type","Number","description","status","IncrementIssueStageDto","UpdateIssueStageDto","IncrementPackingStageDto","UpdatePackingStageDto"],"mappings":";;;;+BAgCaA;;;eAAAA;;;wBAtBN;yBAQA;wCACgC;qCACH;wCACG;uCACD;0CACG;8BACZ;gCACP;iCACM;;;;;;;;;;;;;;;AAMrB,IAAA,AAAMA,4BAAN,MAAMA;IAaXC,sBACE,AAAgCC,OAAe,EAC/C,AAAOC,GAAgB,EACvB;QACA,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAE,GAAGF,IAAIG,IAAI;QACjC,OAAO,IAAI,CAACC,sBAAsB,CAACN,qBAAqB,CAACC,SAASE,QAAQC;IAC5E;IAWAG,oBACE,AAAgCN,OAAe,EAC/C,AAAQO,IAA4B,EACpC,AAAON,GAAgB,EACvB;QACA,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAE,GAAGF,IAAIG,IAAI;QACjC,OAAO,IAAI,CAACC,sBAAsB,CAACC,mBAAmB,CACpDN,SACAO,KAAKC,YAAY,EACjBN,QACAC;IAEJ;IAOAM,iBACE,AAAgCT,OAAe,EAC/C,AAAQO,IAAyB,EACjC,AAAON,GAAgB,EACvB;QACA,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAE,GAAGF,IAAIG,IAAI;QACjC,OAAO,IAAI,CAACC,sBAAsB,CAACI,gBAAgB,CACjDT,SACAO,KAAKC,YAAY,EACjBD,KAAKG,UAAU,EACfR,QACAC;IAEJ;IAOAQ,sBACE,AAAgCX,OAAe,EAC/C,AAAQO,IAA8B,EACtC,AAAON,GAAgB,EACvB;QACA,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAE,GAAGF,IAAIG,IAAI;QACjC,OAAO,IAAI,CAACC,sBAAsB,CAACM,qBAAqB,CACtDX,SACAO,KAAKC,YAAY,EACjBN,QACAC;IAEJ;IAOAS,mBACE,AAAgCZ,OAAe,EAC/C,AAAQO,IAA2B,EACnC,AAAON,GAAgB,EACvB;QACA,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAE,GAAGF,IAAIG,IAAI;QACjC,OAAO,IAAI,CAACC,sBAAsB,CAACO,kBAAkB,CACnDZ,SACAO,KAAKC,YAAY,EACjBD,KAAKM,YAAY,EACjBX,QACAC;IAEJ;IApGA,YACE,AAAiBE,sBAA8C,CAC/D;aADiBA,yBAAAA;IAChB;AAmGL;;;QAjGkBS,SAAS;;;QACbC,MAAM;QAAWC,MAAMC;QAAQC,aAAa;;;QAEtDC,QAAQ;QACRD,aAAa;;;;;;;;;;;;;;;QAYCJ,SAAS;;;QACbC,MAAM;QAAWC,MAAMC;QAAQC,aAAa;;;QAC7CF,MAAMI,8CAAsB;;;QAErCD,QAAQ;QACRD,aAAa;;;;;;;;;;;;;;;;;QAkBCJ,SAAS;;;QACbC,MAAM;QAAWC,MAAMC;QAAQC,aAAa;;;QAC7CF,MAAMK,wCAAmB;;;;;;;;;;;;;;;;;QAkBpBP,SAAS;;;QACbC,MAAM;QAAWC,MAAMC;QAAQC,aAAa;;;QAC7CF,MAAMM,kDAAwB;;;;;;;;;;;;;;;;;QAiBzBR,SAAS;;;QACbC,MAAM;QAAWC,MAAMC;QAAQC,aAAa;;;QAC7CF,MAAMO,4CAAqB"}