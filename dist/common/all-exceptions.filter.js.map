{"version":3,"sources":["../../src/common/all-exceptions.filter.ts"],"sourcesContent":["import {\r\n  ExceptionFilter,\r\n  Catch,\r\n  ArgumentsHost,\r\n  HttpException,\r\n  HttpStatus,\r\n} from '@nestjs/common'\r\nimport { Request, Response } from 'express'\r\nimport { logger } from './logger'\r\n\r\n@Catch()\r\nexport class AllExceptionsFilter implements ExceptionFilter {\r\n  catch(exception: unknown, host: ArgumentsHost) {\r\n    const ctx = host.switchToHttp()\r\n    const req = ctx.getRequest<Request>()\r\n    const res = ctx.getResponse<Response>()\r\n\r\n    const status =\r\n      exception instanceof HttpException\r\n        ? exception.getStatus()\r\n        : HttpStatus.INTERNAL_SERVER_ERROR\r\n\r\n    const responsePayload = exception instanceof HttpException\r\n      ? (exception.getResponse() as any)\r\n      : {\r\n          code: 'INTERNAL_ERROR',\r\n          message: 'Something went wrong. Please try again later.',\r\n        }\r\n\r\n    logger.error(\r\n      {\r\n        component: 'exception-filter',\r\n        status,\r\n        path: req.url,\r\n        requestId: req.headers['x-request-id'],\r\n        code: responsePayload.code,\r\n      },\r\n      exception instanceof Error ? exception.stack! : String(exception)\r\n    )\r\n\r\n    res.status(status).json({\r\n      code: responsePayload.code,\r\n      message: responsePayload.message,\r\n      details: responsePayload.details ?? null,\r\n    })\r\n  }\r\n}\r\n"],"names":["AllExceptionsFilter","catch","exception","host","ctx","switchToHttp","req","getRequest","res","getResponse","status","HttpException","getStatus","HttpStatus","INTERNAL_SERVER_ERROR","responsePayload","code","message","logger","error","component","path","url","requestId","headers","Error","stack","String","json","details"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBALN;wBAEgB;;;;;;;AAGhB,IAAA,AAAMA,sBAAN,MAAMA;IACXC,MAAMC,SAAkB,EAAEC,IAAmB,EAAE;QAC7C,MAAMC,MAAMD,KAAKE,YAAY;QAC7B,MAAMC,MAAMF,IAAIG,UAAU;QAC1B,MAAMC,MAAMJ,IAAIK,WAAW;QAE3B,MAAMC,SACJR,qBAAqBS,qBAAa,GAC9BT,UAAUU,SAAS,KACnBC,kBAAU,CAACC,qBAAqB;QAEtC,MAAMC,kBAAkBb,qBAAqBS,qBAAa,GACrDT,UAAUO,WAAW,KACtB;YACEO,MAAM;YACNC,SAAS;QACX;QAEJC,cAAM,CAACC,KAAK,CACV;YACEC,WAAW;YACXV;YACAW,MAAMf,IAAIgB,GAAG;YACbC,WAAWjB,IAAIkB,OAAO,CAAC,eAAe;YACtCR,MAAMD,gBAAgBC,IAAI;QAC5B,GACAd,qBAAqBuB,QAAQvB,UAAUwB,KAAK,GAAIC,OAAOzB;QAGzDM,IAAIE,MAAM,CAACA,QAAQkB,IAAI,CAAC;YACtBZ,MAAMD,gBAAgBC,IAAI;YAC1BC,SAASF,gBAAgBE,OAAO;YAChCY,SAASd,gBAAgBc,OAAO,IAAI;QACtC;IACF;AACF"}